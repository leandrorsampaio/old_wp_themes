<html>
    <head>
        <link rel="stylesheet"  type="text/css" media="all" href="http://natal.spturis.com.br/wp-content/themes/Natal-Iluminado-WP-2012/style.css" />
    </head>
    <body style="background-color: transparent">
        <div id="calendario_escolha">
            <h3 id="calendario_escolha_titulo2">Clique no calendário ou na lista abaixo para buscar um evento do Natal Iluminado 2012</h3>
            <form action="" method="get">
                <div id="calendario_escolha_data">
                    <h2 id="calendario_escolha_data_titulo">Dezembro de 2012</h2>
                    <div id="calendario_escolha_data_dezHead">
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Seg</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Ter</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Qua</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Qui</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Sex</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Sab</p>
                        </div>
                        <div class="calendario_escolha_data_dezHead_item">
                            <p class="calendario_escolha_data_dezHead_item_texto">Dom</p>
                        </div>
                    </div>
                    <div class="calendario_escolha_data_dezLinha">
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=01" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">1</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=02" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">2</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=03" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">3</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=04" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">4</p>
                        </a>
                    </div>
                    <div class="calendario_escolha_data_dezLinha">
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=05" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">5</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=06" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">6</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=07" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">7</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=08" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">8</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=09" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">9</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=10" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">10</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=11" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">11</p>
                        </a>
                    </div>
                    <div class="calendario_escolha_data_dezLinha">
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=12" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">12</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=13" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">13</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=14" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">14</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=15" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">15</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=16" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">16</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=17" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">17</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=18" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">18</p>
                        </a>
                    </div>
                    <div class="calendario_escolha_data_dezLinha">
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=19" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">19</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=20" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">20</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=21" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">21</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=22" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">22</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=23" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">23</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=24" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">24</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=25" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">25</p>
                        </a>
                    </div>
                    <div class="calendario_escolha_data_dezLinha">
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=26" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">26</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=27" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">27</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=28" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">28</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=29" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">29</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=30" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">30</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="calendario.php?id=calendario&dia=31" name="select" onChange="location=this.value" >
                            <p class="calendario_escolha_data_dezLinha_item_texto">31</p>
                        </a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                        <a class="calendario_escolha_data_dezLinha_item" href="#">&nbsp;</a>
                    </div>

                </div>                         
                <div id="calendario_escolha_tipo">
                    <ul>
                        <h4 id="calendario_escolha_tipo_titulo">Ou escolha por categorias:</h4>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=12&dia=00" name="select" onChange="location=this.value" >
                                Baladas
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=1&dia=00" name="select" onChange="location=this.value" >
                                Bazares e feiras
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=9&dia=00" name="select" onChange="location=this.value" >
                                Ceias
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=10&dia=00" name="select" onChange="location=this.value" >
                                Cursos
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=2&dia=00" name="select" onChange="location=this.value" >
                                Concertos musicais
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=3&dia=00" name="select" onChange="location=this.value" >
                                Decoração Natalina
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=5&dia=00" name="select" onChange="location=this.value" >
                                Presépios
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=6&dia=00" name="select" onChange="location=this.value" >
                                Roteiros Natalinos
                            </a>
                        </li>                              
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=7&dia=00" name="select" onChange="location=this.value" >
                                Teatros
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=11&dia=00" name="select" onChange="location=this.value" >
                                Corridas de Natal
                            </a>
                        </li>
                        <li>
                            <a class="calendario_escolha_tipo_titulo_links" href="calendario.php?id=calendario&cat=0&dia=00" name="select" onChange="location=this.value" >
                                Ver todos
                            </a>
                        </li>
                    </ul>
                </div>
            </form>
            <spam style="font-size:11px; margin: 19px 0 20px 71px; float:left">A programação oficial da Prefeitura irá até o dia 6 de janeiro de 2013.</spam>
        </div>
        <div id="calendario_resultado">
            <?php
// se a data for novembro, <data_inicio) deve permanecer vazio
// checa categoria recebida pela página
            if (empty($_GET["cat"])) {
                $id_categoria = 0;
            } else {
                $id_categoria = $_GET["cat"];
            }

// checa dia recebido pela página
            if (empty($_GET["dia"])) {
                $dia_atual = date("d");
            } else {
                $dia_atual = $_GET["dia"];
            };

            if ($dia_atual > 31) {
                $dia_atual = date("d");
            };

            function exibeTituloCategoria($id_categoria) {
                switch ($id_categoria) {
                    case 0: echo "";
                        break;
                    case 1: echo "<h3 class='calendario_resultado_title'>Bazares e feiras</h3>";
                        break;
                    case 2: echo "<h3 class='calendario_resultado_title'>Concertos musicais</h3>";
                        break;
                    case 3: echo "<h3 class='calendario_resultado_title'>Decoração Natalina</h3>";
                        break;
                    case 4: $id_categoria = 3;
                        break;
                    case 5: echo "<h3 class='calendario_resultado_title'>Presépios</h3>";
                        break;
                    case 6: echo "<h3 class='calendario_resultado_title'>Roteiros Natalinos</h3>";
                        break;
                    case 7: echo "<h3 class='calendario_resultado_title'>Teatros</h3>";
                        break;
                    case 8: echo "<h3 class='calendario_resultado_title'>Ruas comerciais</h3>";
                        break;
                    case 9: echo "<h3 class='calendario_resultado_title'>Ceias de Natal</h3>";
                        break;
                    case 10: echo "<h3 class='calendario_resultado_title'>Cursos</h3>";
                        break;
                    case 11: echo "<h3 class='calendario_resultado_title'>Outros eventos</h3>";
                        break;
                    case 12: echo "<h3 class='calendario_resultado_title'>Baladas</h3>";
                        break;
                    default:;
                        break;
                }
            }

            function checaDia($data_inicio, $data_final, $data_aleatoria, $dia_atual) {
//	echo "<BR><BR>INI: $data_inicio <BR>FIM: $data_final <BR>ALE: $data_aleatoria <BR>ATUAL: $dia_atual";
                if ($dia_atual == 00) {
                    return 1; // sai da função e exibe os eventos sem separacao de data
                };

                if ($data_inicio != NULL) {
                    $dia_ini = substr($data_inicio, 0, 2);
                    $mes_ini = substr($data_inicio, 3, 2);
                } else {
                    $dia_ini = 1;
                    $mes_ini = 12;
                };

                if ($data_final != NULL) {
                    $dia_fim = substr($data_final, 0, 2);
                    $mes_fim = substr($data_final, 3, 2);
                    // se mes_fim 01 (janeiro) ou não numérico, evento acontece em dezembro
                    if ($mes_fim == 01 || !is_numeric($mes_fim)) {
                        $dia_fim = 31;
                        $mes_fim = 12;
                    };
                } else {
                    $dia_fim = 31;
                    $mes_fim = 12;
                };

                if ($data_aleatoria != NULL) {
                    $arrayDataAleatoria = explode(", ", $data_aleatoria);
                    $dia_atual.="/12";
                    if (in_array($dia_atual, $arrayDataAleatoria)) {
                        return 1; // exibe evento	
                    } else {
                        return 0; // não exibe evento
                    };
                };

                if (($dia_atual >= $dia_ini)) { // evento começou
                    if ($dia_atual <= $dia_fim) { // evento terminou		
                        return 1; // exibe evento	
                    } else {
                        return 0; // não exibe evento	
                    };
                } else {
                    return 0; // não exibe evento		
                };
            }

// fim checaDia
            /*
              function montaCombo (){
              //create combo box
              $cbo = '<select name="select" id="select">';
              //create option for each file
              foreach($option as $key=>$val) {
              $cbo .='<option value="'.$val.'">'.$val.'</option>';
              }
              //close combo box
              $cbo .= '</select>';
              //output combo box (might want to put this in a form tag on your final page)
              echo $cbo;
              }
             */

            function exibeEventos($nome, $data_inicio, $data_final, $data_aleatoria, $categoria, $id_categoria, $promotor, $local, $ddd, $telefone, $email, $site, $descricao, $horarios, $precos) {
                // "quebra" variável $categoria em um array de categorias
                $arrayCategorias = explode(",", $categoria);

                if ((in_array($id_categoria, $arrayCategorias)) || ($id_categoria == 0)) {
                    // exibe conteúdo na tela e checa se há variáveis vazias
                    if (($nome != NULL)) {
                        echo "<h4 class='calendario_resultado_nomeEvento'>" . $nome . "</h4>";
                    };
                    if (($data_inicio != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>In&iacute;cio: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$data_inicio</h6>";
                    };
                    if (($data_aleatoria != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Datas: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$data_aleatoria de 2012</h6>";
                    };
                    if (($data_final != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>At&eacute; o dia: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$data_final</h6>";
                    };
                    if (($promotor != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Promotor: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$promotor</h6>";
                    };
                    if (($local != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Local: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$local</h6>";
                    };
                    if (($telefone != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Local: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>(" . $ddd . ")$telefone</h6>";
                    };
                    if (($email != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>E-mail: </h5>" . "<a class='calendario_resultado_dadosLink' href=\"mailto:" . $email . "\">" . $email . "</a>";
                    };
                    if (($site != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Site: </h5>" . "<a class='calendario_resultado_dadosLink' href=\"http://" . $site . "\" target=\"_blank\">" . $site . "</a>";
                    };
                    if (($descricao != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Descri&ccedil;&atilde;o: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$descricao</h6>";
                    };
                    if (($horarios != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Hor&aacute;rios: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$horarios</h6>";
                    };
                    if (($precos != NULL)) {
                        echo "<h5 class='calendario_resultado_dadosFixo'>Pre&ccedil;os: </h5>" . "<h6 class='calendario_resultado_dadosVariavel'>$precos</h6>";
                    };
                }; // fim IF 
            }

// seta arquivo XML como variável PHP
            $xml_file = "calendario.xml";

// carrega o arquivo XML 
            $xml = @simplexml_load_file($xml_file) or die("<p>Erro ao carregar lista. Por favor, tente novamente mais tarde. Desculpe-nos pelo inconveniente.</p>");

// começa a lista de itens
            echo "<div>";

            if ($dia_atual != 00) {
                echo "<h3 class='calendario_resultado_title'>$dia_atual de dezembro</h3>";
            };



// exibe o título da categoria
            exibeTituloCategoria($id_categoria);

// checa item por item do arquivo XML carregado na memoria
            foreach ($xml->item as $item) {
                // converte conteúdo do XML de UTF para ISO
                $nome = iconv("utf-8", "ISO-8859-1", $item->nome);
                $data_inicio = iconv("utf-8", "ISO-8859-1", $item->data_inicio);
                $data_final = iconv("utf-8", "ISO-8859-1", $item->data_final);
                $data_aleatoria = iconv("utf-8", "ISO-8859-1", $item->data_aleatoria);
                $categoria = iconv("utf-8", "ISO-8859-1", $item->categoria);
                $promotor = iconv("utf-8", "ISO-8859-1", $item->promotor);
                $local = iconv("utf-8", "ISO-8859-1", $item->local);
                $ddd = iconv("utf-8", "ISO-8859-1", $item->ddd);
                $telefone = iconv("utf-8", "ISO-8859-1", $item->telefone);
                $email = iconv("utf-8", "ISO-8859-1", $item->email);
                $site = iconv("utf-8", "ISO-8859-1", $item->site);
                $descricao = iconv("utf-8", "ISO-8859-1", $item->descricao);
                $horarios = iconv("utf-8", "ISO-8859-1", $item->horarios);
                $precos = iconv("utf-8", "ISO-8859-1", $item->precos);

                // checa se evento está acontecendo na data recebida
                if (checaDia($data_inicio, $data_final, $data_aleatoria, $dia_atual)) {
                    // exibe os eventos na tela separados por categorias
                    exibeEventos($nome, $data_inicio, $data_final, $data_aleatoria, $categoria, $id_categoria, $promotor, $local, $ddd, $telefone, $email, $site, $descricao, $horarios, $precos);
                };
            } // fim foreach

            echo "</div>";
            ?>
        </div>
    </body>
</html>